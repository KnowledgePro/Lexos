{% extends "base_analyze.html" %}
{% set active_page = 'topword' %}


{% block head %}
    <style type="text/css">
        .topwordResultLegend {
        }
    </style>
    <script type="text/javascript"
            src="{{ url_for('static', filename='js/scripts_topword.js') }}?ver={{ version }}">
    </script>
    <script type="text/javascript">
            var classNum = {{ classmap[1]|length|default(0) }};
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
{% endblock %}

{% block title %}analyzer{% endblock %}


{% block options %}
    <input type="hidden" id="num_active_files" value="{{ labels|len }}"/>

    <div class="row">
        <div class="col-md-6">

            <fieldset class="analyze-advanced-options" id="test-input-options">
                <legend id="testMethod-title">Method for Test
                <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" data-content="" style="" title="Lexos' TopWords is running a proportional z-test on the proportions of words to find the differently used words (Top Words), so the documents should be long enough for the test to be reliable (at least 100 words each). For each Top Word, larger positive z-score indicates a more frequently used word and larger negative z-score indicates a more rarely used word. Only the top 20 statistically significant ones (absolute values larger than 1.96) are shown. Note: when comparing some documents to the rest, you will need to set them into different classes. Scroll down to view the current class(es) in Class Division."></i>
                </legend>
                <div class="test-input-div" id="testInput">
                    {% if numclass == 1 %}
                        <label for="allToPara">
                        <input type="radio" name="testInput" id="allToPara"
                               value="allToPara" checked>
                        Compare each document to all the documents as a whole
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" data-content="" style="" title="Comparing the proportion of each word in a document to that in all the documents as a whole. Example: Find Top Words for one chapter compared to the entire book.."></i>
                        </label>
                    {% else %}
                        <label for="allToPara">
                            <input type="radio" name="testInput" id="allToPara"
                                   value="allToPara" {{ "checked" if session['topwordoption']['testInput'] == 'allToPara' }}>
                            Compare each document to all the documents as a whole
                            <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Comparing the proportion of each word in a document to that word in all the documents as a whole. Example: Find Top Words for one chapter compared to the entire book."></i>
                        </label>
                        <label for="classToPara">
                            <input type="radio" name="testInput" id="classToPara"
                                   value="classToPara" {{ "checked" if session['topwordoption']['testInput'] == 'classToPara' }}>
                            Compare each document against other class(es)
                            <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Comparing the proportion of each word in a document in one class to that in another class as a whole. Example: With two books (two classes), find Top Words in every chapter (document) from one of the books compared to the other book (class)."></i>
                        </label>
                        <label for="classToClass">
                            <input type="radio" name="testInput" id="classToClass"
                                   value="classToClass" {{ "checked" if session['topwordoption']['testInput'] == 'classToClass' }}>
                            Compare classes one to another.
                            <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Comparing the proportion of each word in one class to that in another class. Example: Find Top Words between two books."></i>
                        </label>
                    {% endif %}
                </div>
            </fieldset>
        </div>

        <div class="col-md-6">
            <fieldset class="analyze-advanced-options" id="words-options">
                <legend id="groupOption-title">Advanced Culling
                <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="More ways to cull the potential list of Top Words. Use of these options and Token culling options will reduce the number of Top Words."></i>
                </legend>
                <div class="groupOption-div" id="groupOption-radios">
                    <label>All<input type="radio" name="groupOptionType" value="all" checked/>
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Use all words that appear in both groups."></i>
                    </label>
                    <br>
                    <label class="show-options">Built-in Options
                        <input type="radio" name="groupOptionType"
                               value="bio" {{ 'checked' if session['topwordoption']['groupOptionType'] == 'bio' }} />

                        <div class="outlierMethod-div expansion cf" id="outlierMethod-radios">
                            <hr/>
                            <label class="show-options">Standard Deviation
                                <input type="radio" name="outlierMethodType" value="stdErr" checked/>
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Cull outliers by the standard deviation from the mean on a normal distribution (bell-shaped curve) of frequencies of all words."></i>

                                <div class="outlier-div expansion cf" id="outlier-radios">
                                    <hr/>
                                    <label>Use Top Outlier Only<input type="radio" name="outlierTypeStd" value="top" checked/>
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Only compare words with rather high frequencies. 2 standard deviations above mean."></i>
                                    </label>
                                    <label>Use Non Outlier Only<input type="radio" name="outlierTypeStd"
                                                             value="mid" {{ "checked" if session['topwordoption']['outlierTypeStd'] == 'mid' }}/>
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Only compare words with not too high or too low frequencies. Within 2 standard deviations from Mean."></i>
                                                             </label>
                                    <label>Use Low Outlier Only<input type="radio" name="outlierTypeStd"
                                                             value="low" {{ "checked" if session['topwordoption']['outlierTypeStd'] == 'low' }}/>
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Only compare words with rather low frequencies. 2 standard deviations below mean."></i>
                                                             </label>
                                </div>
                            </label>
                            <label class="show-options">Interquartile Range (IQR)
                                <input type="radio" name="outlierMethodType"
                                       value="iqr" {{ 'checked' if session['topwordoption']['outlierMethodType'] == 'iqr' }}/>
                                <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Cull outliers by comparing to the interquartile range. Note: sometimes there are no outliers on one side or both sides, when the data are skewed or compact."></i>
                                <div class="outlier-div expansion cf" id="outlier-radios">
                                    <hr/>
                                    <label>Use Top Outlier Only<input type="radio" name="outlierTypeIQR" value="top" checked/>
                                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Only compare words with unusually high frequencies which are at least 1.5 interquartile ranges above the third quartile (Q3)."></i>
                                    </label>
                                    <label>Use Non Outlier Only<input type="radio" name="outlierTypeIQR"
                                                             value="mid" {{ "checked" if session['topwordoption']['outlierTypeIQR'] == 'mid' }}/>
                                    <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Only compare words that are not outliers, whose frequencies are 1.5 interquartile ranges below the third quartile (Q3) and 1.5 interquartile ranges above the first quartile (Q1)."></i>
                                    </label>
                                    <label>Use Low Outlier Only<input type="radio" name="outlierTypeIQR"
                                                             value="low" {{ "checked" if session['topwordoption']['outlierTypeIQR'] == 'low' }}/>
                                    <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Only compare words with unusually low frequencies which are at least 1.5 interquartile ranges below the first quartile (Q1)."></i>
                                    </label>
                                </div>
                            </label>
                        </div>
                    </label>

                    <label class="show-options">Customize
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Use words only within a range of proportions or raw counts."></i>
                        <input type="radio" name="groupOptionType"
                               value="customize" {{ 'checked' if session['topwordoption']['groupOptionType'] == 'customize' }}/>

                        <div class="outlierMethod-div expansion cf" id="outlierMethod-radios">
                            <hr/>
                            <label class="show-options">Proportional Counts
                                <input type="radio" name="useFreq" value="PC" checked/>
                        <i class="fa fa-question-circle lexos-tooltip-trigger" data-trigger="hover" data-html="true" data-toggle="tooltip" data-placement="right" data-container="body" style="" title="Word frequencies"></i>

                                <div class="outlier-div expansion cf" id="outlier-radios">
                                    <hr/>
                                    <label>Low Bound - <input type="number" id="lowerboundPC" name="lowerboundPC"
                                                              value={{ session['topwordoption']['lowerboundPC'] }} step="0.05"
                                                              min="0" max="1" style="width: 50px;"/></label>
                                    <label>Upper Bound - <input type="number" id="upperboundPC" name="upperboundPC"
                                                                value={{ session['topwordoption']['upperboundPC'] }} step="0.05"
                                                                min="0" max="1" style="width: 50px;"/></label>
                                </div>
                            </label>
                            <label class="show-options">Raw Counts
                                <input type="radio" name="useFreq"
                                       value="RC" {{ 'checked' if session['topwordoption']['useFreq'] == 'RC' }}/>

                                <div class="outlier-div expansion cf" id="outlier-radios">
                                    <hr/>
                                    <label>Low Bound - <input type="number" id="lowerboundRC" name="lowerboundRC"
                                                              value={{ session['topwordoption']['lowerboundRC'] }} step="1"
                                                              min="0" style="width: 40px;"/></label>
                                    <label>Upper Bound - <input type="number" id="upperboundRC" name="upperboundRC"
                                                                value={{ session['topwordoption']['upperboundRC'] }} step="1"
                                                                min="0" style="width: 40px;"/></label>
                                </div>
                            </label>
                        </div>
                    </label>
                </div>
            </fieldset>
        </div>
    </div>
{% endblock %}


{% block results %}
    <input class="bttn bttn-action" id="gettopword" name="gen-topword" type="submit" value="Get Topwords"/>
    <input type="submit" class="bttn bttn-exit bttndownload" id="topworddownload" name="get-topword" value="Download Matrix"/>

    {# get request display the class division #}
    {% if topwordsgenerated == 'class_div' %}
        <div class="topwordResultDiv">
            <legend class="topwordResultLegend">Class Division:</legend>
                {% if classmap[1]|length == 1 %}
                        please go to <a href='{{ url_for("manage") }}'>Manage page</a> to
                        change the class label</strong></span>
                {% endif %}

                {% for i in range(classmap[1]|length) %}
                {% endfor %}

                <div class="row">
                {% for i in range(classmap[1]|length) %}
                    <div class="col-md-6 topwordTableDivv topwordTableDivClass">
                        {%  if classmap[1][i] == '' %}
                            <p class="topwordResultTableTitle"><strong>Class: untitled</strong></p>
                        {% else %}
                            <p class="topwordResultTableTitle"><strong>Class: "{{ classmap[1][i] }}"</strong></p>
                        {% endif %}
                            <div class="topwordFileTable">
                                {% for filename in classmap[0][i] %}
                                    <p class="topwordFile">{{ filename }}</p>
                                {% endfor %}
                            </div>
                   </div>
                {% endfor %}
                </div>
        </div>

    {% elif topwordsgenerated == 'True' %}
    <div class="row">
        <div class="col-md-12">
            <legend class="topwordResultLegend">{{ header }}</legend>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="topwordResultDiv">
                {% for file in result %}
                    <div class="topwordTableDiv topwordTableDivPZAll">
                        <p class="topwordResultTableTitle"><strong> {{ file[0] }} </strong></p>
                        <table class="table table-striped table-condensed header-fixed">
                            <thead>
                                <th>Top Word</th>
                                <th>Z Score</th>
                            </thead>
                            <tbody>
                            {% for data in file[1] %}
                                <tr>
                                    <td>{{ data[0] }}</td>
                                    <td>{{ data[1] }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

{% endblock %}


{% block submit %}
<!--     <p style="color: red"><strong> Warning: TopWord is currently in BETA</strong></p>
    <input class="bttn bttn-action" id="gettopword" name="gen-topword" type="submit" value="Get Topwords"/>
    <input type="submit" class="bttn bttn-exit bttndownload" id="topworddownload" name="get-topword" value="Download Matrix"/> -->
{% endblock %}