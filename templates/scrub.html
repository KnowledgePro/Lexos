{% extends "base.html" %}
{% set active_page = 'scrub' %}

{% block head %}

<script type="text/javascript" src="{{ url_for('static', filename='js/scripts_scrub.js') }}"></script>
<!-- <script type="text/javascript" src="{{ url_for('static', filename='flat/js/bootstrap-modal.js') }}"></script> -->
{% endblock %}

{% block title %}scrubber{% endblock %}

{% block formstart %}
-
<form id="scrub" action="" method="POST" enctype="multipart/form-data">
{% endblock %}

{% block field %}

<fieldset id="normalscrubbingoptions">
<legend>Scrubbing Options</legend>

<input type="hidden" id="usecacheswfileselect" name="usecacheswfileselect" value="" {{ 'disabled' if session['scrubbingoptions']['optuploadnames']['swfileselect[]'] == '' else '' }}/>
<input type="hidden" id="usecachelemfileselect" name="usecachelemfileselect" value="" {{ 'disabled' if session['scrubbingoptions']['optuploadnames']['lemfileselect[]'] == '' else '' }}/>
<input type="hidden" id="usecacheconsfileselect" name="usecacheconsfileselect" value="" {{ 'disabled' if session['scrubbingoptions']['optuploadnames']['consfileselect[]'] == '' else '' }}/>
<input type="hidden" id="usecachescfileselect" name="usecachescfileselect" value="" {{ 'disabled' if session['scrubbingoptions']['optuploadnames']['scfileselect[]'] == '' else '' }}/>

<input type="hidden" id="num_active_files" value="{{ num_active_files }}" />

<div>
	<div id="mainscruboptions">
		<label class="checkbox" id="punctbox" for="punctuationbox">
			<input type="checkbox" name="punctuationbox" id="punctuationbox" {{"checked" if session['scrubbingoptions']['punctuationbox'] else ""}} data-toggle="checkbox">
			Remove All Punctuation
		</label>
		<label class="checkbox" for="lowercasebox">
			<input type="checkbox" name="lowercasebox" id="lowercasebox" {{"checked" if session['scrubbingoptions']['lowercasebox'] else ""}} data-toggle="checkbox">
			Make Lowercase
		</label>
			<label class="checkbox" for="digitsbox">
			<input type="checkbox" name="digitsbox" id="digitsbox" {{"checked" if session['scrubbingoptions']['digitsbox'] else ""}} data-toggle="checkbox">
			Remove Digits
		</label>
		<label class="checkbox {{ '' if haveTags else 'hidden' }}"  for="tagbox">
			<input type="checkbox" name="tagbox" id="tagbox" {{"checked" if session['scrubbingoptions']['tagbox'] else ""}} data-toggle="checkbox">
			Remove Tags
		</label>
	</div>
	<div class="{{ '' if session['scrubbingoptions']['punctuationbox'] else 'hidden' }}" id="aposhyph">
		<label class="checkbox" for="hyphensbox">
			<input type="checkbox" name="hyphensbox" id="hyphensbox" {{"checked" if session['scrubbingoptions']['hyphensbox'] else ""}} data-toggle="checkbox">
			Keep Hyphens
		</label>
		<label class="checkbox" for="aposbox">
			<input type="checkbox" name="aposbox" id="aposbox" {{"checked" if session['scrubbingoptions']['aposbox'] else ""}} data-toggle="checkbox">
			Keep Possessive<br />Apostrophes
		</label>
	</div>
</div>
<div id="tagsradiodiv" class="{{ '' if haveDOE else 'hidden' }}">
	<label>You have text(s) from the Dictionary of Old English. Would you like to:
		<label class="radio" id="tagsradio" for="ktags">
			<input type="radio" name="tags" value="keep" id="ktags" {{"checked" if session['scrubbingoptions']['keepDOEtags'] else ""}} data-toggle="radio"/>Keep Words Between corr/foreign Tags
		</label>
		<label class="radio" for="dtags">
			<input type="radio" name="tags" value="discard" id="dtags" {{"checked" if not session['scrubbingoptions']['keepDOEtags'] else ""}} data-toggle="radio" />Discard Words Between corr/foreign Tags
		</label>
	</label>
</div>

</fieldset>

<fieldset id="additionalscrubbingoptions">
<legend id="advancedtitle">Advanced Options <div class="expandbttn"></div></legend>

<div class="advancedoptions">
	<div>
		<input type="file" id="swfileselect" name="swfileselect[]" />
		<div class= "bttn optionbttn" id="stopwords">Stopwords</div>
		<div class="questionmark scrub large"></div>
		<div class="tooltip scrub general">Input a list of stopwords (words to be removed). Manual input and files should be formatted alike.</div>

		<div id="stopwordinput" class="{{ 'hidden' if not session['scrubbingoptions']['optuploadnames']['swfileselect[]'] and not session['scrubbingoptions']['manualstopwords'] and not request.form['manualstopwords'] }}">
			<textarea class="manualinput" name="manualstopwords" placeholder="Enter stopwords..." >{{ request.form['manualstopwords'] or session['scrubbingoptions']['manualstopwords'] }}</textarea>
			<div class="questionmark scrub small"></div>

  		<div class="tooltip scrub format">Stopwords list format: a list of comma-, space- or newline separated words to be removed from the text.</div>

			/

			<div class="optuploadbuttondiv">
				<div class="bttnfilelabels" id="swfileselectbttnlabel">
					{{ session['scrubbingoptions']['optuploadnames']['swfileselect[]'] + '(using stored)' if session['scrubbingoptions']['optuploadnames']['swfileselect[]'] != '' }} 
				</div>
				<div class="bttn uploadbttn" id="prettystopwordsupload">Upload File</div>
			</div>
		</div>
	</div>

	<div>
		<input type="file" id="lemfileselect" name="lemfileselect[]"/>
		<div class= "bttn optionbttn" id="lemmas">Lemmas</div>
		<div class="questionmark scrub large"></div>
  	<div class="tooltip scrub general">Input a list of lemmas (word replacements). Manual input and files should be formatted alike.</div>

		<div id="lemmainput" class="{{ 'hidden' if not session['scrubbingoptions']['optuploadnames']['lemfileselect[]'] and not session['scrubbingoptions']['manuallemmas'] and not request.form['manuallemmas'] }}">
			<textarea class="manualinput" name="manuallemmas" placeholder="Enter lemmas..." >{{ request.form['manuallemmas'] or session['scrubbingoptions']['manuallemmas'] }}</textarea>
			<div class="questionmark scrub small"></div>

  		<div class="tooltip scrub format">Lemma list format: Each line should be comma separated element(s) followed by the element with which to replace them (e.g. 'cyng, kyng, king' will replace 'cyng' and 'kyng' with 'king'). Note: colons (':') can be used to force the replacement character to the beginning or end; the side with more than one element will be those replaced (default behavior: left).</div>  		

			/

			<div class="optuploadbuttondiv">
				<div class="bttnfilelabels" id="lemfileselectbttnlabel">
					{{ session['scrubbingoptions']['optuploadnames']['lemfileselect[]'] + '(using stored)' if session['scrubbingoptions']['optuploadnames']['lemfileselect[]'] != '' }}
				</div>
				<div class="bttn uploadbttn" id="prettylemmasupload">Upload File</div>
			</div>
		</div>
	</div>

	<div>
		<input type="file" id="consfileselect" name="consfileselect[]"/>
		<div class= "bttn optionbttn" id="consolidations">Consolidations</div> 
		<div class="questionmark scrub large"></div>
  	<div class="tooltip scrub general">Input a list of consolidations (character replacements). Manual input and files should be formatted alike.</div>

		<div id="consolidationsinput" class="{{ 'hidden' if not session['scrubbingoptions']['optuploadnames']['consfileselect[]'] and not session['scrubbingoptions']['manualconsolidations'] and not request.form['manualconsolidations'] }}">
			<textarea class="manualinput" name="manualconsolidations" placeholder="Enter consolidations..." >{{ request.form['manualconsolidations'] or session['scrubbingoptions']['manualconsolidations'] }}</textarea>
			<div class="questionmark scrub small"></div>

  		<div class="tooltip scrub format">Consolidations list format: Each line should be comma separated element(s) followed by the element with which to replace them (e.g. 'a, b, c' will replace 'a' and 'b' with 'c'). Note: colons (':') can be used to force the replacement character to the beginning or end; the side with more than one element will be those replaced (default behavior: left).</div>

			/

			<div class="optuploadbuttondiv">
				<div class="bttnfilelabels" id="consfileselectbttnlabel">
					{{ session['scrubbingoptions']['optuploadnames']['consfileselect[]'] + '(using stored)' if session['scrubbingoptions']['optuploadnames']['consfileselect[]'] != '' }}
				</div>
				<div class="bttn uploadbttn" id="prettyconsolidationsupload">Upload File</div>
			</div>
		</div>
	</div>

	<div>
		<input type="file" id="scfileselect" name="scfileselect[]"/>
		<div class= "bttn optionbttn" id="specialchars">Special Characters</div> 
		<div class="questionmark scrub large"></div>
  	<div class="tooltip scrub general">Input a list of rules for handling non-unicode special characters. Manual input and files should be formatted alike.</div>

		<div id="specialcharsinput" class="{{ 'hidden' if not session['scrubbingoptions']['optuploadnames']['scfileselect[]'] and not session['scrubbingoptions']['manualspecialchars'] and session['scrubbingoptions']['entityrules'] == 'none' else '' }}">

			<select id="entityrules" name="entityrules">
				<option value="none" {{ "selected" if request.form['entityrules'] == 'none' or session['scrubbingoptions']['entityrules'] == 'none'}}> - Select Built-In Option - </option>
				<option value="default" {{ "selected" if request.form['entityrules'] == 'default' or session['scrubbingoptions']['entityrules'] == 'default' }}>Default</option>
				<option value="doe-sgml" {{ "selected" if request.form['entityrules'] == 'doe-sgml' or session['scrubbingoptions']['entityrules'] == 'doe-sgml'}}>Dictionary of Old English SGML</option>
				<option value="early-english-html"  {{ "selected" if request.form['entityrules'] == 'early-english-html' or session['scrubbingoptions']['entityrules'] == 'early-english-html'}}>Early English HTML</option>
			</select>

			<a href="{{ url_for('static', filename='pre_defined_rules.html') }}" target="_blank" id="ruleslink">View Pre-Defined Rule Sets</a>
			<div class="newline" id="specialchartext"><strong>or</strong></div>
			<textarea class="manualinput" name="manualspecialchars" placeholder="Enter special characters...">{{ request.form['manualspecialchars'] or session['scrubbingoptions']['manualspecialchars'] }}</textarea>
			<div class="questionmark scrub small specchars"></div>

  		<div class="tooltip scrub format">Special characters list format: Each line should be comma separated element(s) followed by the element with which to replace them (e.g. '&amp;aelig;, ae, &aelig;' will replace '&amp;aelig;' and 'ae' with '&aelig;'). Note: colons (':') can be used to force the replacement character to the beginning or end; the side with more than one element will be those replaced (defaults to left if one on each side).</div> 
  		
			/

			<div class="optuploadbuttondiv">
				<div class="bttnfilelabels" id="scfileselectbttnlabel">
					{{ session['scrubbingoptions']['optuploadnames']['scfileselect[]'] + '(using stored)' if session['scrubbingoptions']['optuploadnames']['scfileselect[]'] != '' }}
				</div>
				<div class="bttn uploadbttn" id="prettyspecialcharsupload">Upload File</div>
			</div>
		</div>
	</div>
</div>

</fieldset>
{% endblock %}


{% block submit %}
<input class="bttn bttn-action" type="submit" name="preview" value="Preview Scrubbing"/>
<input class="bttn bttn-apply" type="submit" name="apply" value="Apply Scrubbing"/>
<input class="bttn bttn-exit" type="submit" name="download" value="Download Scrubbed Files"/>
{% endblock %}



{% block content %}

{% autoescape false %}
{% for (fileID, filename, file) in previews %}

<fieldset>
<legend>{{filename}} Preview</legend>
	<div class="filecontents">{{file}}</div> <!-- Keep this with no whitespace! -->
</fieldset>

{%- endfor %}
{% endautoescape %}

{% endblock %}
