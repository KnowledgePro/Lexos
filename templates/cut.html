{% extends "base.html" %}
{% set active_page = 'cut' %}

{% block head %}
<script type="text/javascript" src="{{ url_for('static', filename='js/scripts_cut.js') }}"></script>
{% endblock %}


{% block title %}cutter{% endblock %}

{% block formstart %}
<form id="cut" action="" method="POST" enctype="multipart/form-data">
{% endblock %}

{% block field %}

<input type="hidden" id="num_active_files" value="{{ num_active_files }}" />

<fieldset class="cuttingoptionswrapper">
<legend>Default Cutting Options</legend>
  <div>
    <label class="radio sizeradio" id="sizeradio">
      <input type="radio" name="cuttype" value="size" {{ "checked" if session['cuttingoptions']['overall']['cuttingType'] == 'Size' or request.form['radio'] == 'size' }} data-toggle="radio">
      Segment Size
    </label>
    <label class="radio numberradio" id="numberradio">
      <input type="radio" name="cuttype" value="number" {{ "checked" if session['cuttingoptions']['overall']['cuttingType'] == 'Number' or request.form['radio'] == 'number' }} data-toggle="radio">
      Number of Segments
    </label>
  </div>


  <div class="cuttingdiv">
		<div  class="cuttinginput" id="cuttingsize">
			<label class="cuttingoptionslabel inline">{{ 'Number of Segments' if session['cuttingoptions']['overall']['cuttingType'] == 'Number' or request.form['radio'] == 'number' else 'Segment Size' }}:</label>
			<input class="textinput cuttingValue cuttextinput" 
			name="cuttingValue" 
			id="overallcutvalue"
			type="number"
			value="{{ request.form['cuttingValue'] or session['cuttingoptions']['overall']['cuttingValue'] }}"/>
			<div class="questionmark cut"></div>
			<div class="tooltip cut">Value to segment text by (e.g. number of segments per text or number of words per segment).</div>
		</div>
		<div class="cuttinginput">
			<label class="inline">Overlap:</label>
			<input class="textinput cuttextinput"
			name="overlap"
			type="number"
			value="{{ request.form['overlap'] or session['cuttingoptions']['overall']['overlap'] }}"/>
			<div class="questionmark cut"></div>
			<div class="tooltip cut">Number of words to overlap at segment boundaries.</div>
		</div>
		<div class="cuttinginput lastpropdiv {{ 'transparent' if session['cuttingoptions']['overall']['cuttingType'] == 'Number' or request.form['radio'] == 'number' else '' }}">
			<label class="inline">Last Proportion Threshold&nbsp;(%):</label>
			<div class="questionmark cut"></div>
			<div class="tooltip cut">Minimum proportion of the given size that the last segment can be.</div>
			<input {{ "disabled" if session['cuttingoptions']['overall']['cuttingType'] == 'Number' or request.form['radio'] == 'number' else "" }}
			class="textinput lastpropinput"
			name="lastprop"
			id="lastprop"
			type="number"
			value="{{ request.form['lastprop'] or session['cuttingoptions']['overall']['lastProp'] }}"/>
		</div>
	</div>
</fieldset>
<fieldset id="cutrenamingdiv">
	<legend>Cut Set Labelling Options</legend>
	<div class="individualcuttingcheckboxes">
	<div>
		<label class="checkbox" for="usewordboundaries">
			<input type="checkbox" name="usewordboundaries" id="usewordboundaries" {{"checked" if request.form['usewordboundaries']}} data-toggle="checkbox">
			Use Segment Boundaries
		</label>
		<div class="questionmark cut boundlabel"></div>
		<div class="tooltip cut boundlabel">Includes the word counts for the first and last words of the segment in the cut set name (e.g. Daniel_1-450.txt, Daniel_451-900, etc.) .</div>
	</div>
<div>
	<label class="checkbox" for="usesegmentnumber">
		<input type="checkbox" name="usesegmentnumber" id="usesegmentnumber" {{"checked" if request.form['usesegmentnumber']}} data-toggle="checkbox">
		Use Segment Number
	</label>
	<div class="questionmark cut numberlabel"></div>
	<div class="tooltip cut numberlabel">Includes the segment number in the cut set name (e.g. Daniel_CUT#1.txt, Daniel_CUT#2.txt, etc.) .</div>
</div>
</div>
</fieldset>

<fieldset id="cuttingmodediv">
	<div>
	<label class="checkbox" for="supercuttingmode" id="supercuttingmodelabel">
		<input type="checkbox" name="supercuttingmode" id="supercuttingmode" {{"checked" if request.form['supercuttingmode']}} data-toggle="checkbox" {{ 'disabled' if previews|count != 1 }}>
		Super Cutting Mode
	</label>
	<div class="questionmark cut supercut"></div>
	<div class="tooltip cut supercut">Using one original file, Super Cutting Mode allows for the creation of multiple cut sets. While enabled, each cut set that is created will be sent to the manage page as inactive files. Super Cutting Mode can only be enabled when one file is active.</div>
	</div>
	<span class="submiterrors" id="supercuttingmodemessage">Cut files created and set automatically as disabled, original kept active.</span>
</fieldset>
{% endblock %}




{% block submit %}
<input class="bttn bttn-action" type="submit" id="cutaction" value="Preview Cuts" name="preview"/>
<input class="bttn bttn-apply" type="submit" id="cutapply" value="Apply Cuts" name="apply"/>
<input class="bttn bttn-exit" type="submit" id="downloadchunks" name="downloadchunks" value="Download Segmented Files"/>

<span class="submiterrors" id="cutsubmiterrormessage1">You haven't filled out a sufficient number of segment fields.</span>
<span class="submiterrors" id="cutsubmiterrormessage2">You cannot enter a value of 0 for a segment field.</span>
{% endblock %}




{% block content %}
{% for (fileID, filename, file) in previews | sort %}
<fieldset class="individualpreviewwrapper">

<legend class="individualpreviewlegend">{{filename}} Preview &nbsp;
<div class="bttn indivcutbuttons">Individual Options</div>
</legend>

<div class="cuttingoptionswrapper {{ 'hidden' if not filename in session['cuttingoptions'] and not request.form['cuttingValue_'+filename] }}">
<fieldset class="cuttingoptionsfieldset">
	<legend class="individualcuttingoptionstitle">Individual Cutting Options</legend>
	<div>
		<label class="radio sizeradio">
			<input type="radio" name="radio_{{ filename }}" value="size" checked data-toggle="radio">
			Segment Size
		</label>
		<label class="radio numberradio">
			<input type="radio" name="radio_{{ filename }}" value="number" {{ "checked" if request.form['radio_'+filename] == 'number' or filename in session['cuttingoptions'] and session['cuttingoptions'][filename]['cuttingType'] == 'Number' }} data-toggle="radio">
			Number of Segments
		</label>
	</div>
	<div class="cuttingdiv individcut">
		<div class="cuttinginput">
			<label class="cuttingoptionslabel inline">{{ 'Number of Segments' if request.form['radio_'+filename] == 'number' or filename in session['cuttingoptions'] and session['cuttingoptions'][filename]['cuttingType'] == 'Number' else 'Segment Size'}}:</label>
			<input class="textinput cuttingValue cuttextinput" 
			name="cuttingValue_{{ filename }}" 
			type="text" 
			value="{{ request.form['cuttingValue_'+filename] or (session['cuttingoptions'][filename]['cuttingValue'] if filename in session['cuttingoptions'] else '') }}"/>
		</div>
		<div class="cuttinginput">
			<label class="inline">Overlap:</label>
			<input class="textinput cuttextinput"
			name="overlap_{{ filename }}" 
			type="text" 
			value="{{ request.form['overlap_'+filename] or (session['cuttingoptions'][filename]['overlap'] if filename in session['cuttingoptions'] else '0') }}"/>
		</div>
		<div class="cuttinginput lastpropdiv {{ 'transparent' if request.form['radio_'+filename] == 'number' or (filename in session['cuttingoptions'] and session['cuttingoptions'][filename]['cuttingType'] == 'Number') }}">
			<label class="inline">Last Proportion Threshold:</label>
			<input {{ "disabled" if filename in session['cuttingoptions'] and session['cuttingoptions'][filename]['cuttingType'] == 'Number' else "" }}
			class="textinput lastpropinput"
			name="lastprop_{{ filename }}"
			type="text"
			value="{{ request.form['lastprop_'+filename] or (session['cuttingoptions'][filename]['lastProp'] if filename in session['cuttingoptions'] else '50') }}"/>
		</div>
	</div>

</fieldset>
<fieldset id="cutrenamingdiv">
	<legend>Cutset Labelling Options</legend>
	<input type="text"
	name="cutsetnaming_{{ filename }}"
	class="cutsetnaming"
	value="{{ '.'.join(filename.split('.')[:-1]) }}">

</fieldset>
</div>

<div class="newline">
{% if file|type != dict()|type %}
	{{file}}
{% else %}
{% for index, cutpreview in file.items() %}
	{% if loop.index==6 and index > 5 %}
		<br>
	{% endif %}

	<fieldset>
	<legend class="individualpreviewlegend">Segment {{index+1}}</legend>
	{{cutpreview}}
	</fieldset>

{% endfor %}
{% endif %}
</div>

</fieldset>

{% endfor %}
{% endblock %}